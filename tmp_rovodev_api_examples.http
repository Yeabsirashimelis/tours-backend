### Tours Backend API - Example Requests
### Use with REST Client extension or Postman

@baseUrl = http://localhost:3000/api/v1
@token = YOUR_JWT_TOKEN_HERE

###########################################
# AUTHENTICATION
###########################################

### Sign Up (Sends Welcome Email)
POST {{baseUrl}}/users/signup
Content-Type: application/json

{
  "name": "John Doe",
  "email": "john@example.com",
  "password": "password123",
  "passwordConfirm": "password123"
}

# Note: Welcome email will be sent to the user's email address

### Login
POST {{baseUrl}}/users/login
Content-Type: application/json

{
  "email": "john@example.com",
  "password": "password123"
}

### Forgot Password (Sends HTML Reset Email)
POST {{baseUrl}}/users/forgotPassword
Content-Type: application/json

{
  "email": "john@example.com"
}

# Note: HTML password reset email will be sent with a styled button

### Reset Password
PATCH {{baseUrl}}/users/resetPassword/RESET_TOKEN_HERE
Content-Type: application/json

{
  "password": "newPassword123",
  "passwordConfirm": "newPassword123"
}

### Update My Password (Logged in users)
PATCH {{baseUrl}}/users/updateMyPassword
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "passwordCurrent": "password123",
  "password": "newPassword456",
  "passwordConfirm": "newPassword456"
}

###########################################
# USERS
###########################################

### Update My Profile Data (with JSON)
PATCH {{baseUrl}}/users/updateMe
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "John Updated",
  "email": "johnupdated@example.com"
}

### Update My Profile with Photo Upload (multipart/form-data)
# Note: Use Postman or similar tool for file uploads
# This is a form-data request with:
# - photo: [Select image file]
# - name: "John Updated"
# - email: "johnupdated@example.com"
PATCH {{baseUrl}}/users/updateMe
Authorization: Bearer {{token}}
Content-Type: multipart/form-data

# In Postman:
# Body > form-data
# Key: photo, Type: File, Value: [select image]
# Key: name, Type: Text, Value: John Updated
# Key: email, Type: Text, Value: johnupdated@example.com

### Delete Me (Soft delete)
DELETE {{baseUrl}}/users/deleteMe
Authorization: Bearer {{token}}

### Get All Users (Admin only)
GET {{baseUrl}}/users
Authorization: Bearer {{token}}

### Get User by ID (Admin only)
GET {{baseUrl}}/users/USER_ID_HERE
Authorization: Bearer {{token}}

### Update User (Admin only)
PATCH {{baseUrl}}/users/USER_ID_HERE
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Updated Name",
  "role": "guide"
}

### Delete User (Admin only)
DELETE {{baseUrl}}/users/USER_ID_HERE
Authorization: Bearer {{token}}

###########################################
# TOURS
###########################################

### Get All Tours
GET {{baseUrl}}/tours
Authorization: Bearer {{token}}

### Get Top 5 Cheap Tours
GET {{baseUrl}}/tours/top-5-cheap

### Get Tour by ID
GET {{baseUrl}}/tours/TOUR_ID_HERE

### Create Tour (Admin/Lead-guide only)
POST {{baseUrl}}/tours
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "The Amazing Adventure Tour",
  "duration": 7,
  "maxGroupSize": 15,
  "difficulty": "medium",
  "price": 497,
  "summary": "An amazing week-long adventure",
  "description": "Full description here...",
  "imageCover": "tour-cover.jpg",
  "images": ["img1.jpg", "img2.jpg"],
  "startDates": ["2024-06-01", "2024-07-15", "2024-08-10"],
  "guides": ["GUIDE_USER_ID_1", "GUIDE_USER_ID_2"],
  "startLocation": {
    "coordinates": [-122.419415, 37.774929],
    "address": "San Francisco, CA",
    "description": "Golden Gate Bridge"
  },
  "locations": [
    {
      "coordinates": [-122.406417, 37.785834],
      "description": "Fisherman's Wharf",
      "day": 1
    },
    {
      "coordinates": [-122.083855, 37.421999],
      "description": "Palo Alto",
      "day": 3
    }
  ]
}

### Update Tour (JSON - without images)
PATCH {{baseUrl}}/tours/TOUR_ID_HERE
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "price": 599,
  "maxGroupSize": 20
}

### Update Tour with Images (multipart/form-data)
# Note: Use Postman or similar tool for file uploads
# Admin or Lead-Guide only
# This is a form-data request with:
# - imageCover: [Select 1 image file for cover]
# - images: [Select up to 3 image files for gallery]
# - Other fields (price, name, etc.) as text
PATCH {{baseUrl}}/tours/TOUR_ID_HERE
Authorization: Bearer {{token}}
Content-Type: multipart/form-data

# In Postman:
# Body > form-data
# Key: imageCover, Type: File, Value: [select cover image]
# Key: images, Type: File, Value: [select image 1]
# Key: images, Type: File, Value: [select image 2]
# Key: images, Type: File, Value: [select image 3]
# Key: price, Type: Text, Value: 599
# Key: maxGroupSize, Type: Text, Value: 20

### Delete Tour (Admin/Lead-guide only)
DELETE {{baseUrl}}/tours/TOUR_ID_HERE
Authorization: Bearer {{token}}

### Get Tour Statistics
GET {{baseUrl}}/tours/tour-stats

### Get Monthly Plan
GET {{baseUrl}}/tours/monthly-plan/2024

### Advanced Filtering Examples
GET {{baseUrl}}/tours?duration[gte]=5&difficulty=easy
GET {{baseUrl}}/tours?price[lt]=500&ratingsAverage[gte]=4.5
GET {{baseUrl}}/tours?sort=-ratingsAverage,price&fields=name,price,duration

###########################################
# GEOSPATIAL QUERIES
###########################################

### Find Tours Within Radius (300 miles from Los Angeles)
GET {{baseUrl}}/tours/tours-within/300/center/34.0522,-118.2437/unit/mi

### Find Tours Within Radius (200 km from San Francisco)
GET {{baseUrl}}/tours/tours-within/200/center/37.7749,-122.4194/unit/km

### Calculate Distances from New York (in miles)
GET {{baseUrl}}/tours/distances/40.7128,-74.0060/unit/mi

### Calculate Distances from Denver (in kilometers)
GET {{baseUrl}}/tours/distances/39.7392,-104.9903/unit/km

### Find Tours Near Your Location (example: Chicago)
GET {{baseUrl}}/tours/tours-within/150/center/41.8781,-87.6298/unit/mi

### Get All Tours by a Specific Guide
GET {{baseUrl}}/tours/guide/GUIDE_USER_ID_HERE

###########################################
# REVIEWS
###########################################

### Get All Reviews
GET {{baseUrl}}/reviews
Authorization: Bearer {{token}}

### Get Reviews for a Specific Tour
GET {{baseUrl}}/tours/TOUR_ID_HERE/reviews
Authorization: Bearer {{token}}

### Create Review
POST {{baseUrl}}/reviews
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "review": "This tour was absolutely amazing! The guide was knowledgeable and friendly.",
  "rating": 5,
  "tour": "TOUR_ID_HERE"
}

### Create Review via Nested Route
POST {{baseUrl}}/tours/TOUR_ID_HERE/reviews
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "review": "Great experience overall. Highly recommended!",
  "rating": 4
}

### Get Specific Review
GET {{baseUrl}}/reviews/REVIEW_ID_HERE
Authorization: Bearer {{token}}

### Update My Review
PATCH {{baseUrl}}/reviews/REVIEW_ID_HERE
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "review": "Updated review text here",
  "rating": 5
}

### Delete My Review
DELETE {{baseUrl}}/reviews/REVIEW_ID_HERE
Authorization: Bearer {{token}}

###########################################
# BOOKINGS
###########################################

### Get Checkout Session (Start booking process)
GET {{baseUrl}}/bookings/checkout-session/TOUR_ID_HERE
Authorization: Bearer {{token}}

### Get My Bookings
GET {{baseUrl}}/bookings/my-bookings
Authorization: Bearer {{token}}

### Get All Bookings (Admin/Lead-guide only)
GET {{baseUrl}}/bookings
Authorization: Bearer {{token}}

### Get Specific Booking (Admin/Lead-guide only)
GET {{baseUrl}}/bookings/BOOKING_ID_HERE
Authorization: Bearer {{token}}

### Create Booking Manually (Admin/Lead-guide only)
POST {{baseUrl}}/bookings
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "tour": "TOUR_ID_HERE",
  "user": "USER_ID_HERE",
  "price": 497
}

### Update Booking (Admin/Lead-guide only)
PATCH {{baseUrl}}/bookings/BOOKING_ID_HERE
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "paid": true
}

### Delete Booking (Admin/Lead-guide only)
DELETE {{baseUrl}}/bookings/BOOKING_ID_HERE
Authorization: Bearer {{token}}

###########################################
# NOTES
###########################################

# Booking Flow:
# 1. User calls GET /bookings/checkout-session/:tourId
# 2. Backend creates Stripe checkout session and returns URL
# 3. Frontend redirects user to Stripe checkout page
# 4. User enters payment details on Stripe
# 5. After successful payment, Stripe redirects to success URL
# 6. Backend creates booking record
# 7. User can view booking in /bookings/my-bookings

# Setup Required:
# 1. Get Stripe API keys from https://dashboard.stripe.com/test/apikeys
# 2. Add STRIPE_SECRET_KEY to config.env
# 3. For webhooks (optional): Add STRIPE_WEBHOOK_SECRET

# Geospatial Queries:
# - Format: latitude,longitude (e.g., 34.0522,-118.2437)
# - Units: mi (miles) or km (kilometers)
# - Tours must have startLocation with GeoJSON coordinates
# - Sample locations provided in dev-data/data/sample-tour-locations.json

# Major US Cities for Testing:
# - Los Angeles: 34.0522,-118.2437
# - San Francisco: 37.7749,-122.4194
# - New York: 40.7128,-74.0060
# - Denver: 39.7392,-104.9903
# - Chicago: 41.8781,-87.6298
# - Miami: 25.7617,-80.1918
